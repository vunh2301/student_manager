{% extends "base.html" %}
{% block content %}
<div class="p-4">
  <nav aria-label="breadcrumb" style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
      <li class="breadcrumb-item"><a href="/lop-hoc">Quản lý lớp học</a></li>
      <li class="breadcrumb-item" aria-current="page">Lớp {{lop_hoc.name}} - Năm học <span class="badge text-bg-primary">{{lop_hoc.nam_hoc}}</span></li>
    </ol>
  </nav>
  <ul class="nav nav-tabs">
    <li class="nav-item">
      <a class="nav-link" href="/lop-hoc/{{lop_hoc.id}}">Quản lý học sinh</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/lop-hoc/{{lop_hoc.id}}/trung-binh">Bảng điểm trung bình</a>
    </li>
    <li class="nav-item">
      <span class="nav-link active" aria-current="page">Nhập điểm môn học</span>
    </li>
  </ul>
  <div class="table-responsive">
    <form method="POST">
      <div class="d-flex justify-content-between py-3">
        <div>
          <strong>Môn hoc: </strong> <select class="form-select form-select-sm d-inline" style="width: 200px;" id="mon_hoc" onchange="handleChange('mon_hoc')">
            {% for option in ds_mon_hoc %}    
            <option value="{{option.id}}" {% if mon_hoc == option.id %}selected{% endif %}>{{option.name}}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <button class="btn btn-primary btn-sm " type="submit">Lưu bảng điểm</button>
        </div>
      </div>
      <div style="overflow:auto;">
        <table class="table table-hover table-bordered table-sm">
          <thead class="table-light align-middle text-center">
            <tr>
              <th scope="col" rowspan="3">STT</th>
              <th scope="col" rowspan="3" style="min-width: 200px;">Họ tên</th>
              <th scope="col" colspan="9">Hoc kỳ 1</th>
              <th scope="col" colspan="9">Hoc kỳ 2</th>
            </tr>
            <tr>
              <th scope="col" colspan="5">Điểm 15 phút</th>
              <th scope="col" colspan="3">Điểm 1 tiết</th>
              <th scope="col" rowspan="2" style="min-width: 90px;">Điểm thi</th>
              <th scope="col" colspan="5">Điểm 15 phút</th>
              <th scope="col" colspan="3">Điểm 1 tiết</th>
              <th scope="col" rowspan="2" style="min-width: 90px;">Điểm thi</th>
            </tr>
            <tr>
              <th style="min-width: 60px;">1</th>
              <th style="min-width: 60px;">2</th>
              <th style="min-width: 60px;">3</th>
              <th style="min-width: 60px;">4</th>
              <th style="min-width: 60px;">5</th>
              <th style="min-width: 60px;">1</th>
              <th style="min-width: 60px;">2</th>
              <th style="min-width: 60px;">3</th>
              <th style="min-width: 60px;">1</th>
              <th style="min-width: 60px;">2</th>
              <th style="min-width: 60px;">3</th>
              <th style="min-width: 60px;">4</th>
              <th style="min-width: 60px;">5</th>
              <th style="min-width: 60px;">1</th>
              <th style="min-width: 60px;">2</th>
              <th style="min-width: 60px;">3</th>
            </tr>
          </thead>
          <tbody>
            {% for item in ds_bang_diem_lop_hoc %}
              <tr>
                <td class="text-center">{{loop.index}}</td>
                <td>{{item.name}}<input type="hidden" name="id[]" value="{{item.id}}" /><input type="hidden" name="hoc_sinh_id[]" value="{{item.hoc_sinh_id}}" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk1_1[]" value="{{item.diem_15p_hk1_1}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk1_2[]" value="{{item.diem_15p_hk1_2}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk1_3[]" value="{{item.diem_15p_hk1_3}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk1_4[]" value="{{item.diem_15p_hk1_4}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk1_5[]" value="{{item.diem_15p_hk1_5}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_45p_hk1_1[]" value="{{item.diem_45p_hk1_1}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_45p_hk1_2[]" value="{{item.diem_45p_hk1_2}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_45p_hk1_3[]" value="{{item.diem_45p_hk1_3}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_thi_hk1[]" value="{{item.diem_thi_hk1}}" max="10" min="0" /></td>
                
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk2_1[]" value="{{item.diem_15p_hk2_1}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk2_2[]" value="{{item.diem_15p_hk2_2}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk2_3[]" value="{{item.diem_15p_hk2_3}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk2_4[]" value="{{item.diem_15p_hk2_4}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_15p_hk2_5[]" value="{{item.diem_15p_hk2_5}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_45p_hk2_1[]" value="{{item.diem_45p_hk2_1}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_45p_hk2_2[]" value="{{item.diem_45p_hk2_2}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_45p_hk2_3[]" value="{{item.diem_45p_hk2_3}}" max="10" min="0" /></td>
                <td><input class="form-control form-control-sm text-end" type="number" name="diem_thi_hk2[]" value="{{item.diem_thi_hk2}}" max="10" min="0" /></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="d-flex justify-content-between py-3">
        <div>
          <strong>Môn hoc: </strong> <select class="form-select form-select-sm d-inline" style="width: 200px;" id="mon_hoc" onchange="handleChange('mon_hoc')">
            {% for option in ds_mon_hoc %}    
            <option value="{{option.id}}" {% if mon_hoc == option.id %}selected{% endif %}>{{option.name}}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <button class="btn btn-primary btn-sm " type="submit">Lưu bảng điểm</button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
  const handleChange = (field) => {
    let url = new URL(window.location.href);
    url.searchParams.set(field, document.getElementById(field).value);
    window.location = url.href;
  }
</script>
{% endblock %}
